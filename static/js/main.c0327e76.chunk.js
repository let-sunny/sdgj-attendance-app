(window["webpackJsonpsdgj-attendance-app"]=window["webpackJsonpsdgj-attendance-app"]||[]).push([[0],{19:function(e,t,n){e.exports=n.p+"static/media/sdgj_horizontal_logo.79e03f6f.png"},20:function(e,t,n){e.exports=n(34)},25:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(18),c=n.n(s),o=(n(25),n(7)),i=n(3),u=n.n(i),l=n(5),f=n(6),d=n(10),p=n(12),m=n(11),h=n(13);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach(function(t){Object(o.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var v=function e(t){var n=this;Object(f.a)(this,e),this.getUser=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a=n.firebase.db.collection("users").doc(t.email),e.next=6,a.get();case 6:if((r=e.sent).exists){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",y({email:r.id},r.data()));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),console.log(e.t0);case 17:case"end":return e.stop()}},e,null,[[2,14]])}));return function(t){return e.apply(this,arguments)}}(),this.setUser=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a=n.firebase.db.collection("users").doc(t.email),e.next=6,a.get();case 6:if((r=e.sent).exists){e.next=12;break}return e.next=10,a.set({createdAt:(new Date).getTime(),name:t.displayName||"",isMember:!1,imageUrl:t.photoURL||"",deviceToken:t.deviceToken||""});case 10:e.next=14;break;case 12:return e.next=14,a.set({lastSignedIn:(new Date).getTime(),deviceToken:t.deviceToken||r.data().deviceToken},{merge:!0});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.log(e.t0);case 19:case"end":return e.stop()}},e,null,[[2,16]])}));return function(t){return e.apply(this,arguments)}}(),this.firebase=t};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach(function(t){Object(o.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).firebase=n.props.firebase,n.state={user:null,isFetching:!0},n.getToken=Object(l.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.firebase.messaging.getToken();case 3:(t=e.sent)?n.setState({deviceToken:t}):console.log("No Instance ID token available. Request permission to generate one."),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])})),n.setUser=function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new v(n.firebase).setUser(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.user=function(){var e=Object(l.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,n.setUser(w({},t,{deviceToken:n.state.deviceToken}));case 3:n.setState({user:t,isFetching:!1});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.signIn=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.firebase.signIn();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}},e,null,[[0,5]])})),n.signOut=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.firebase.signOut();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}},e,null,[[0,5]])})),n.requestPermission=function(){console.log("Requesting permission..."),Notification.requestPermission().then(function(e){"granted"===e?console.log("Notification permission granted."):console.log("Unable to get permission to notify.")})},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.firebase.auth.onAuthStateChanged(this.user);case 2:if(!this.firebase.messaging){e.next=8;break}return e.next=5,this.firebase.messaging.onTokenRefresh(this.getToken);case 5:return e.next=7,this.getToken();case 7:this.requestPermission();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.isFetching?r.a.createElement("div",null,r.a.createElement("p",null,"...")):this.state.user?r.a.createElement("div",null,this.state.user.photoURL?r.a.createElement("img",{src:this.state.user.photoURL,alt:this.state.user.email}):r.a.createElement("p",null,this.state.user.email||this.state.user.phoneNumber)):r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){return e.signIn()}},"\uc785\uc7a5"))}}]),t}(r.a.Component),k=n(15),j=n(4),x=n.n(j),E=(n(28),n(19)),P=n.n(E);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(n,!0).forEach(function(t){Object(o.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var D=function e(t){var n=this;Object(f.a)(this,e),this.setAttendance=function(){var e=Object(l.a)(u.a.mark(function e(t,a){var r,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a&&t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,r=n.firebase.db.collection("attendances").doc(t).collection("members").doc(a.email),e.next=6,r.get();case 6:if((s=e.sent).exists){e.next=12;break}return e.next=10,r.set({createdAt:(new Date).getTime(),name:a.name,isDeleted:!1});case 10:e.next=14;break;case 12:return e.next=14,r.set({isDeleted:!s.data().isDeleted,updatedAt:(new Date).getTime()},{merge:!0});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.log(e.t0);case 19:case"end":return e.stop()}},e,null,[[2,16]])}));return function(t,n){return e.apply(this,arguments)}}(),this.getAttendances=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,a=n.firebase.db.collection("attendances").doc(t).collection("members").where("isDeleted","==",!1).orderBy("createdAt"),e.next=6,a.get();case 6:if((r=e.sent).empty){e.next=12;break}return s=r.docs,e.abrupt("return",s.map(function(e){return S({},e.data(),{email:e.id})}));case 12:return e.abrupt("return",[]);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),console.log(e.t0);case 18:case"end":return e.stop()}},e,null,[[2,15]])}));return function(t){return e.apply(this,arguments)}}(),this.firebase=t},N=function(e){function t(){var e,n;Object(f.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).firebase=n.props.firebase,n.state={dateObject:x()(),startX:null,key:0},n.weekdayShort=x.a.weekdaysShort(),n.firstDayOfMonth=function(){var e=n.state.dateObject;return x()(e).startOf("month").format("d")},n.daysInMonth=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.state.dateObject;return new Array(e.daysInMonth()).fill(0).map(function(e,t){return t+1})},n.month=function(){return n.state.dateObject.format("M")},n.year=function(){return n.state.dateObject.format("Y")},n.onPrev=Object(l.a)(u.a.mark(function e(){var t,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.dateObject.subtract(1,"month"),e.next=3,Promise.all(n.daysInMonth(t).map(function(e){return n.attendances(e)}));case 3:a=e.sent,n.setState({dateObject:t,attendances:a});case 5:case"end":return e.stop()}},e)})),n.onNext=Object(l.a)(u.a.mark(function e(){var t,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.dateObject.add(1,"month"),e.next=3,Promise.all(n.daysInMonth(t).map(function(e){return n.attendances(e)}));case 3:a=e.sent,n.setState({dateObject:t,attendances:a});case 5:case"end":return e.stop()}},e)})),n.onAttend=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r,s,c,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.account,e.next=3,new v(n.firebase).getUser(a);case 3:if(r=e.sent,a&&r&&r.isMember){e.next=8;break}alert("\uc815\uccb4\ub97c \ubc1d\ud600\ub77c !"),e.next=19;break;case 8:if(window.confirm("\uc9c4\uc9dc \ucd9c\uc11d \ud588\uc5b4 ?")){e.next=11;break}return e.abrupt("return");case 11:return s=n.state.dateObject,c=x()({years:s.format("Y"),months:Number(s.format("MM"))-1,date:t}).format("YYYYMMDD"),e.next=15,new D(n.firebase).setAttendance(c,r);case 15:return e.next=17,Promise.all(n.daysInMonth().map(function(e){return n.attendances(e)}));case 17:o=e.sent,n.setState({attendances:o});case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.onTouchStart=function(e){n.setState({startX:e.targetTouches[0].clientX})},n.onTouchEnd=function(e){var t=n.state.startX,a=e.changedTouches[0].clientX;Math.abs(a-t)>130&&(a-t>0?n.onPrev():n.onNext()),n.setState({startX:null})},n.isToday=function(e){var t=n.state.dateObject,a=x()({years:t.format("Y"),months:Number(t.format("MM"))-1,date:e}),r=x()().format("YYYY-MM-DD");return!!a.isSame(r)},n.isSunday=function(e){var t=n.state.dateObject;return 0===x()({years:t.format("Y"),months:Number(t.format("MM"))-1,date:e}).day()},n.isSaturday=function(e){var t=n.state.dateObject;return 6===x()({years:t.format("Y"),months:Number(t.format("MM"))-1,date:e}).day()},n.isHoliday=function(e){var t=n.state.dateObject,a=[x()({years:n.year(),months:0,date:1}),x()({years:n.year(),months:0,date:1}).solar(),x()({years:n.year(),months:0,date:1}).solar().subtract(1,"day"),x()({years:n.year(),months:0,date:1}).solar().add(1,"day"),x()({years:n.year(),months:2,date:1}),x()({years:n.year(),months:4,date:5}),x()({years:n.year(),months:4,date:12}),x()({years:n.year(),months:5,date:6}),x()({years:n.year(),months:7,date:15}),x()({years:n.year(),months:7,date:15}).solar(),x()({years:n.year(),months:7,date:15}).solar().subtract(1,"day"),x()({years:n.year(),months:7,date:15}).solar().add(1,"day"),x()({years:n.year(),months:9,date:3}),x()({years:n.year(),months:9,date:9}),x()({years:n.year(),months:11,date:25})],r=x()({years:t.format("Y"),months:Number(t.format("MM"))-1,date:e});return!!a.find(function(e){return e.isSame(r)})},n.attendances=function(){var e=Object(l.a)(u.a.mark(function e(t){var a,r,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.dateObject,r=x()({years:a.format("Y"),months:Number(a.format("MM"))-1,date:t}).format("YYYYMMDD"),e.next=4,new D(n.firebase).getAttendances(r);case 4:return s=e.sent,e.abrupt("return",Object(o.a)({},r,s));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){var t,n,a=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.daysInMonth().map(function(e){return a.attendances(e)}));case 2:return t=e.sent,e.next=5,this.firebase.auth.currentUser;case 5:n=e.sent,this.setState({attendances:t,account:n});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.weekdayShort.map(function(e,t){var n="";switch(t){case 0:n="\u65e5";break;case 1:n="\u6708";break;case 2:n="\u706b";break;case 3:n="\u6c34";break;case 4:n="\u6728";break;case 5:n="\uf90a";break;case 6:n="\u571f"}return r.a.createElement("th",{key:e,className:"calendar-week-day"},r.a.createElement("p",{className:"ch"},n),r.a.createElement("p",{className:"en"},e.toUpperCase()))}),n=new Array(Number(this.firstDayOfMonth())).fill(0).map(function(e,t){return r.a.createElement("td",{key:"blank-".concat(t),className:"calendar-day blank"},"")}),a=this.daysInMonth().map(function(t){var n=["calendar-day"];e.isToday(t)&&n.push("today"),(e.isSunday(t)||e.isHoliday(t))&&n.push("holiday"),e.isSaturday(t)&&n.push("saturday");var a=x()({years:e.state.dateObject.format("Y"),months:Number(e.state.dateObject.format("MM"))-1,date:t}).format("YYYYMMDD"),s=e.state.attendances&&e.state.attendances.find(function(e){return e[a]}),c=!1;return s=s&&s[a].map(function(t){return c||(c=t.email===(e.state.account&&e.state.account.email)),r.a.createElement("button",{className:"attendance",key:t},t.name&&t.name.slice(0,1)||"\ucd9c")}),r.a.createElement("td",{key:t,className:n.join(" ")},r.a.createElement("button",{type:"button",className:"btn-attend ",name:t,onClick:function(){return e.onAttend(t)},disabled:c},t),r.a.createElement("div",{className:"attendance-area"},s))}),s=[].concat(Object(k.a)(n),Object(k.a)(a)),c=[],o=[];s.forEach(function(e,t){0===t||t%7!==0?o.push(e):(c.push(o),(o=[]).push(e)),t===s.length-1&&c.push(o)});var i=c.map(function(e,t){return r.a.createElement("tr",{key:"week-".concat(t)},e)});return r.a.createElement("div",{className:"calendar"},r.a.createElement("section",{className:"calendar-header"},r.a.createElement("div",{className:"calendar-label"},r.a.createElement("div",{className:"calendar-label-month"},this.month().toUpperCase()),r.a.createElement("div",{className:"calendar-label-year"}," ",this.year()))),r.a.createElement("section",{className:"calendar-body",onTouchStart:function(t){return e.onTouchStart(t)},onTouchEnd:function(t){return e.onTouchEnd(t)}},r.a.createElement("table",{className:"calendar-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,t)),r.a.createElement("tbody",null,i))),r.a.createElement("section",{className:"calendar-footer"},r.a.createElement("img",{src:P.a,alt:"logo"}),r.a.createElement("p",{className:"address"},"\uc11c\uc6b8 \ub9c8\ud3ec\uad6c \uc11c\uad50\ub3d9 358-93"),r.a.createElement("p",{className:"copy-rights"},"\xa9 2019 \uc2dc\ub300\uacf5\uc791")))}}]),t}(r.a.Component),T=r.a.createContext(null);var Y=function(){return r.a.createElement(T.Consumer,null,function(e){return r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement(O,{firebase:e})),r.a.createElement("main",null,r.a.createElement(N,{firebase:e})))})},A=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function U(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}var I=n(8),C=n.n(I),R=(n(29),n(31),n(35),{apiKey:"AIzaSyCucVu9k4l944a0FrnsfUD3Zi-4ZvwMvjk",authDomain:"sdgj-ffd0b.firebaseapp.com",databaseURL:"https://sdgj-ffd0b.firebaseio.com",projectId:"sdgj-ffd0b",storageBucket:"sdgj-ffd0b.appspot.com",messagingSenderId:"736755019580",appId:"1:736755019580:web:b8f5a87042a028b5"}),W=function e(){var t=this;Object(f.a)(this,e),this.signIn=function(){return t.auth.signInWithRedirect(t.googleProvider)},this.signOut=function(){return t.auth.signOut()},C.a.initializeApp(R),this.auth=C.a.auth(),this.db=C.a.firestore(),C.a.messaging.isSupported()&&(this.messaging=C.a.messaging(),this.messaging.usePublicVapidKey("BKT5Y-lwDSUMVzfmiRGUUSzBEnE1fz0_2VEABChqJer6pf-r7JHnQPAWlSBcSCYclfyL2pePRIrBRuL6y3efkqY")),this.googleProvider=new C.a.auth.GoogleAuthProvider};"serviceWorker"in navigator&&navigator.serviceWorker.register("../firebase-messaging-sw.js").then(function(e){console.log("Registration successful, scope is:",e.scope)}).catch(function(e){console.log("Service worker registration failed, error:",e)}),c.a.render(r.a.createElement(T.Provider,{value:new W},r.a.createElement(Y,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/sdgj-attendance-app",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/sdgj-attendance-app","/service-worker.js");A?(!function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):U(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):U(t,e)})}}()}},[[20,1,2]]]);
//# sourceMappingURL=main.c0327e76.chunk.js.map